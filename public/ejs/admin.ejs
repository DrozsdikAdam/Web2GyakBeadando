<!-- ====== Banner Section Start -->
<div
  class="relative z-10 overflow-hidden pb-[60px] pt-[120px] dark:bg-dark md:pt-[130px] lg:pt-[160px]"
>
  <div
    class="absolute bottom-0 left-0 w-full h-px bg-linear-to-r from-stroke/0 via-stroke to-stroke/0 dark:via-dark-3"
  ></div>
  <div class="container mx-auto px-4">
    <div class="flex flex-wrap items-center -mx-4">
      <div class="w-full px-4">
        <div class="text-center">
          <h1
            class="mb-4 text-3xl font-bold text-dark dark:text-white sm:text-4xl md:text-[40px] md:leading-[1.2]"
          >
            Adminisztrációs felület
          </h1>
          <p class="mb-5 text-base text-body-color dark:text-dark-6">
            Itt kezelheted az oldal statisztikáit és felhasználóit.
          </p>

          <ul class="flex items-center justify-center gap-[10px]">
            <li>
              <a
                href="<%= basePath %>/"
                class="flex items-center gap-[10px] text-base font-medium text-dark dark:text-white"
              >
                Home
              </a>
            </li>
            <li>
              <a
                href="javascript:void(0)"
                class="flex items-center gap-[10px] text-base font-medium text-body-color dark:text-dark-6"
              >
                <span class="text-body-color dark:text-dark-6"> / </span>
                Admin
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ====== Banner Section End -->

<!-- ====== Statisztika Section Start -->
<section class="pt-20 pb-10 lg:pt-[120px] lg:pb-20 dark:bg-dark">
    <div class="container mx-auto px-4">
        <div class="w-full px-4">
            <div class="max-w-full mx-auto text-center mb-12">
                <h2 class="font-bold text-3xl sm:text-4xl md:text-[40px] text-dark dark:text-white mb-4">
                    Oldal Statisztika
                </h2>
            </div>
        </div>
        <div class="flex flex-wrap justify-center -mx-4">
            <!-- Felhasználók száma -->
            <div class="w-full md:w-1/2 lg:w-1/3 px-4">
                <div class="px-8 py-12 mb-8 text-center bg-white dark:bg-dark-2 rounded-xl shadow-lg">
                    <h4 class="font-semibold text-xl text-dark dark:text-white mb-2">Felhasználók</h4>
                    <p id="stats-users" class="font-bold text-4xl text-primary">0</p>
                </div>
            </div>
            <!-- Üzenetek száma -->
            <div class="w-full md:w-1/2 lg:w-1/3 px-4">
                <div class="px-8 py-12 mb-8 text-center bg-white dark:bg-dark-2 rounded-xl shadow-lg">
                    <h4 class="font-semibold text-xl text-dark dark:text-white mb-2">Üzenetek</h4>
                    <p id="stats-messages" class="font-bold text-4xl text-primary">0</p>
                </div>
            </div>
            <!-- Táblák száma -->
            <div class="w-full md:w-1/2 lg:w-1/3 px-4">
                <div class="px-8 py-12 mb-8 text-center bg-white dark:bg-dark-2 rounded-xl shadow-lg">
                    <h4 class="font-semibold text-xl text-dark dark:text-white mb-2">Táblák</h4>
                    <p id="stats-tables" class="font-bold text-4xl text-primary">0</p>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- ====== Statisztika Section End -->

<!-- ====== Felhasználók Section Start -->
<section class="pb-20 lg:pb-[120px] dark:bg-dark">
    <div class="container mx-auto px-4">
        <div class="w-full px-4">
            <div class="max-w-full mx-auto text-center mb-12">
                <h2 class="font-bold text-3xl sm:text-4xl md:text-[40px] text-dark dark:text-white mb-4">
                    Felhasználók listája
                </h2>
            </div>
        </div>
        <div id="users-table-container" class="overflow-x-auto relative shadow-md sm:rounded-lg">
            <!-- A felhasználói táblázat ide lesz generálva -->
        </div>
        <div id="loading-spinner" class="text-center py-8 hidden">
            <p class="text-primary">Adatok betöltése...</p>
        </div>
    </div>
</section>
<!-- ====== Felhasználók Section End -->

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const basePath = '<%= basePath %>';
        const usersTableContainer = document.getElementById('users-table-container');
        const loadingSpinner = document.getElementById('loading-spinner');

        // Statisztikák betöltése
        const fetchStats = async () => {
            try {
                const response = await fetch(`${basePath}/admin/stats`);
                if (!response.ok) throw new Error('Statisztika betöltése sikertelen.');
                const stats = await response.json();

                document.getElementById('stats-users').textContent = stats.felhasznaloCount || 0;
                document.getElementById('stats-messages').textContent = stats.uzenetCount || 0;
                document.getElementById('stats-tables').textContent = stats.tablaCount || 0;
            } catch (error) {
                console.error(error);
            }
        };

        // Felhasználók betöltése és táblázat generálása
        const fetchUsers = async () => {
            loadingSpinner.classList.remove('hidden');
            try {
                const response = await fetch(`${basePath}/admin/felhasznalok`);
                if (!response.ok) throw new Error('Felhasználók betöltése sikertelen.');
                const users = await response.json();

                if (users.length === 0) {
                    usersTableContainer.innerHTML = '<p class="text-center text-body-color dark:text-dark-6 py-4">Nincsenek regisztrált felhasználók.</p>';
                    return;
                }

                // Táblázat generálása
                const table = document.createElement('table');
                table.className = 'min-w-full w-full text-sm text-left text-body-color dark:text-dark-6';

                const thead = document.createElement('thead');
                thead.className = 'text-xs font-semibold uppercase bg-gray-1 dark:bg-dark-3';
                const headerRow = document.createElement('tr');
                headerRow.className = 'bg-dark-3';
                const headers = ['ID', 'Felhasználónév', 'Email', 'Szerepkör'];
                const headerKeys = ['id', 'username', 'email', 'role'];

                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.scope = 'col';
                    th.className = 'py-4 text-lg text-center text-dark dark:text-white px-6';
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white dark:bg-dark-2 border-b border-stroke dark:border-dark-3';
                    headerKeys.forEach(key => {
                        const td = document.createElement('td');
                        td.className = 'py-4 px-6 text-base text-center text-body-color dark:text-dark-6';
                        td.textContent = user[key];
                        row.appendChild(td);
                    });
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                usersTableContainer.innerHTML = ''; // Előző tartalom törlése
                usersTableContainer.appendChild(table);

            } catch (error) {
                usersTableContainer.innerHTML = `<p class="text-center text-red-500 py-4">Hiba: ${error.message}</p>`;
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        };

        // Függvények meghívása az oldal betöltődésekor
        fetchStats();
        fetchUsers();
    });
</script>